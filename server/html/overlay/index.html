<!DOCTYPE html>
<html>
    <head>
        <style>
            .html, body {
                padding: 0;
                margin: 0;
            }
            .wrapper {
                width: 1920px;
                height: 1080px;
                position: absolute;
            }
            .secondaryRune {
                position: absolute;
                width: 20px;
                height: 20px;
            }
            .p1 {
                top: 215px;
            }
            .p2 {
                top: 318px;
            }
            .p3 {
                top: 421px;
            }
            .p4 {
                top: 524px;
            }
            .p5 {
                top: 627px;
            }
            .bp {
                left: 15px;
            }
            .rp {
                right: 15px;
            }

            .inhibtimers {
                position: absolute;
                width: 262px;
                height: 100px;
                left: 1655px;
                top: 700px;
                background-color: #122d2a;
                border: 3px solid #ad8242;
                border-right: none;
            }

            .timer {
                font-size: 25px;
                position: absolute;
            }

            .bt {
                color: #0099e0;
                left: 25px;
            }

            .rt {
                color: #e83d3d;
                right: 25px;
            }

            .top {
                top: 7px;
            }

            .mid {
                top: 37px;
            }

            .bot {
                top: 67px;
            }

            .inhibicon {
                position: absolute;
                width: 30px;
                height: 30px;
                left: 45%;
            }
        </style>
    </head>
    <body>
        <div class="wrapper">
            <img id="rune0" class="secondaryRune p1 bp" src="Inspiration_icon.png">
            <img id="rune1" class="secondaryRune p2 bp" src="Domination_icon.png">
            <img id="rune2" class="secondaryRune p3 bp" src="Resolve_icon.png">
            <img id="rune3" class="secondaryRune p4 bp" src="Sorcery_icon.png">
            <img id="rune4" class="secondaryRune p5 bp" src="Precision_icon.png">
            <img id="rune5" class="secondaryRune p1 rp" src="Inspiration_icon.png">
            <img id="rune6" class="secondaryRune p2 rp" src="Inspiration_icon.png">
            <img id="rune7" class="secondaryRune p3 rp" src="Inspiration_icon.png">
            <img id="rune8" class="secondaryRune p4 rp" src="Inspiration_icon.png">
            <img id="rune9" class="secondaryRune p5 rp" src="Inspiration_icon.png">

            <div id="inhibtimers" class="inhibtimers" status="shown">
                <div id="bluetop" class="timer bt top">0:00</div>
                <div id="bluemid" class="timer bt mid">0:00</div>
                <div id="bluebot" class="timer bt bot">0:00</div>
                <div id="redtop" class="timer rt top">0:00</div>
                <div id="redmid" class="timer rt mid">0:00</div>
                <div id="redbot" class="timer rt bot">0:00</div>
                <img class="inhibicon top" src="Top_icon.png">
                <img class="inhibicon mid" src="Middle_icon.png">
                <img class="inhibicon bot" src="Bottom_icon.png">
            </div>
        </div>
        <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
        <script>
            let inhibTimers = {};

            function updateTimer(elem, time) {
                if(time < 0) {
                    elem.text("---")
                    return;
                }
                var seconds = time % 60;
                var minutesPreDivision = time - seconds;
                var minutes = minutesPreDivision / 60;
                if(minutes == NaN) {
                    minutes = 0;
                }
                if(seconds < 10) {
                    elem.text(minutes + ":0" + seconds);
                } else {
                    elem.text(minutes + ":" + seconds);
                }
            }

            //UPDATE RUNES
            function updateRunes() {
                $.getJSON("/overlay/playerdata", (data) => {
                    if(data == {}) return;
                    data.forEach(function(element, index) {
                        var tree = element.runes.secondaryRuneTree.id;
                        var imgname = "";
                        switch(tree) {
                            case 8200:
                                imgname = "Sorcery_icon.png";
                                break;
                            case 8000:
                                imgname = "Precision_icon.png";
                                break;
                            case 8100:
                                imgname = "Domination_icon.png";
                                break;
                            case 8300:
                                imgname = "Inspiration_icon.png";
                                break;
                            case 8400:
                                imgname = "Resolve_icon.png";
                                break;
                        }
                        $('#rune' + index).attr('src', imgname);
                    });
                });
            }

            //UPDATE INHIBTIMERS
            function updateInhibtimers() {
                inhibTimers = {
                    "blue": {
                        "top": -1,
                        "mid": -1,
                        "bot": -1
                    },
                    "red": {
                        "top": -1,
                        "mid": -1,
                        "bot": -1
                    }
                }
                $.getJSON('/overlay/gamedata', (gdata) => {
                    $.getJSON('/overlay/eventdata', (edata) => {
                        edata.Events.forEach(function(element) {
                            if(element.EventName == "InhibKilled" && (gdata.gameTime - element.EventTime) < 300) {
                                let timeUntilInhibUp = Math.floor(300 - (gdata.gameTime - element.EventTime));
                                switch(element.InhibKilled) {
                                    case "Barracks_T1_C1":
                                        inhibTimers.blue.mid = timeUntilInhibUp;
                                        break;
                                    case "Barracks_T1_L1":
                                        inhibTimers.blue.top = timeUntilInhibUp;
                                        break;
                                    case "Barracks_T1_R1":
                                        inhibTimers.blue.bot = timeUntilInhibUp;
                                        break;
                                    case "Barracks_T2_C1":
                                        inhibTimers.red.mid = timeUntilInhibUp;
                                        break;
                                    case "Barracks_T2_R1":
                                        inhibTimers.red.bot = timeUntilInhibUp;
                                        break;
                                    case "Barracks_T2_L1":
                                        inhibTimers.red.top = timeUntilInhibUp;
                                        break;
                                }   
                            }
                        });
                        if(inhibTimers.blue.top < 0 &&
                        inhibTimers.blue.mid < 0 &&
                        inhibTimers.blue.bot < 0 &&
                        inhibTimers.red.top < 0 &&
                        inhibTimers.red.mid < 0 &&
                        inhibTimers.red.bot < 0 &&
                        $('#inhibtimers').attr("status") == "shown") {
                            $('#inhibtimers').slideUp();
                            $('#inhibtimers').attr("status", "hidden");
                        }

                        if((inhibTimers.blue.top != -1 ||
                        inhibTimers.blue.mid != -1 ||
                        inhibTimers.blue.bot != -1 ||
                        inhibTimers.red.top != -1 ||
                        inhibTimers.red.mid != -1 ||
                        inhibTimers.red.bot != -1) &&
                        $('#inhibtimers').attr("status") == "hidden") {
                            $('#inhibtimers').slideDown();
                            $('#inhibtimers').attr("status", "shown");
                        }

                        updateTimer($('#bluetop'), inhibTimers.blue.top)
                        updateTimer($('#bluemid'), inhibTimers.blue.mid)
                        updateTimer($('#bluebot'), inhibTimers.blue.bot)
                        updateTimer($('#redtop'), inhibTimers.red.top)
                        updateTimer($('#redmid'), inhibTimers.red.mid)
                        updateTimer($('#redbot'), inhibTimers.red.bot)
                    });
                });
            }

            setInterval(() => {
                updateRunes();
                updateInhibtimers();
            }, 1000);
        </script>
    </body>
</html>